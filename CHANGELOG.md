# 更新日志

本文档记录 WeiboDR-Uploader 的所有重要版本更新和变更。

---

## [v3.0] - 2025-12-02

### 🎉 重大更新 - 多图床架构

#### 架构重构
- ✅ 从"主力+备份"模式升级为"多图床并行"架构
- ✅ 插件化上传器设计（IUploader 接口 + BaseUploader 抽象类）
- ✅ 工厂模式管理上传器（UploaderFactory）
- ✅ 多图床编排器（MultiServiceUploader）
- ✅ 最多 3 个图床并行上传，限流控制

#### 新增图床支持
- ✅ **TCL 图床** - 开箱即用，无需任何配置
- ✅ **京东图床** - 开箱即用，速度极快
- ✅ **牛客图床** - 需要 Cookie 认证（7-30 天有效期）
- ✅ 保留原有：微博图床、Cloudflare R2

#### 并行上传功能
- ✅ 支持同时选择多个图床（最多 3 个并行）
- ✅ 第一个上传成功的作为主力图床
- ✅ 其他图床作为备份（互为冗余）
- ✅ 每个图床独立显示上传进度
- ✅ 智能降级：某个图床失败不影响其他图床
- ✅ 配置验证：启用前检查配置完整性

#### 链接管理优化
- ✅ 微博代理前缀管理（多前缀支持）
- ✅ 前缀快速切换
- ✅ 自定义前缀添加和删除
- ✅ 预设前缀：百度图片代理、CDN JSON
- ✅ 链接前缀迁移工具（向后兼容旧版 baiduPrefix）

#### 历史记录增强
- ✅ 新增"照片墙"视图（网格布局）
- ✅ 支持按图床筛选（全部/微博/R2/TCL/京东/牛客）
- ✅ 表格视图 + 网格视图无缝切换
- ✅ 存储所有图床的上传结果
- ✅ 显示主力图床标识
- ✅ 懒加载优化（每次加载 50 条）

#### 配置结构变更
- ✅ `UserConfig` 重构：`enabledServices: ServiceType[]`
- ✅ `HistoryItem` 重构：存储多图床结果（`results[]`）
- ✅ 新增 `LinkPrefixConfig` 类型
- ✅ 配置迁移工具（`migrateConfig`）
- ✅ 向后兼容旧版本配置

#### UI/UX 改进
- ✅ 上传窗口：图床多选复选框
- ✅ 进度显示：每个图床独立进度条
- ✅ 历史记录：网格视图懒加载
- ✅ 筛选器：按图床类型筛选
- ✅ 设置页面：每个图床独立配置区域

#### 开发者体验
- ✅ 模板上传器（`TemplateUploader.ts`）
- ✅ 统一的错误处理
- ✅ 详细的日志输出
- ✅ TypeScript 严格类型检查
- ✅ 配置脱敏工具（`sanitizeConfig`）

### 📝 详细信息
完整技术细节请查看 [record.md](record.md)

### ⚠️ 破坏性变更
- 配置结构变更（应用会自动检测并迁移，无需手动操作）
- 历史记录格式变更（保留兼容性，旧记录正常显示）

### 🔄 迁移指南
应用会自动检测旧配置并迁移到新格式，用户无需手动操作。

---

## [v2.6] - 2025-11-18

### 🚀 性能优化

#### R2 列表"按需刷新"机制
- 引入"脏标记 (Dirty Flag)"机制
- 只在数据变更时才重新加载 R2 列表
- 显著减少不必要的网络请求和 API 调用

#### UI 优化
- 调整 R2 图片网格尺寸为 160px（桌面端）和 120px（移动端）
- 使用 `aspect-ratio` 保持 1:1 正方形比例
- 响应式设计，自动适应不同屏幕尺寸

#### UX 优化
- 上传队列新任务自动显示在列表顶部（倒序排列）
- 滚动条自动回到顶部，让用户看到最新进度
- 符合用户对"最新内容在前"的直觉

### 📝 详细信息

完整技术细节请查看 [v2.6 优化总结](docs/archive/V2.6_OPTIMIZATION_SUMMARY.md)

---

## [v2.0] - 2025-11-18

### ✨ 新功能

#### 实时上传队列管理器
- 重构"上传"视图为可视化上传队列
- 支持批量上传和并发处理（最多 3 个文件同时上传）
- 每个文件独立显示微博和 R2 上传进度
- 实时状态反馈：等待、进行中、完成、失败

#### 文件类型验证
- 自动验证文件类型（支持 jpg、png、gif、bmp、webp）
- 不符合格式的文件自动跳过并提示

#### R2 开关控制
- UI 新增"同时备份到 Cloudflare R2"复选框
- 可选择是否在上传时备份到 R2

#### 预览与链接复制
- 上传成功后显示图片缩略图
- 支持一键复制微博、百度代理、R2 三种链接格式

### 🔧 技术改进

- 新增 `uploadQueue.ts` 上传队列管理器
- 重构 `coreLogic.ts` 支持进度回调
- 改进并发控制逻辑
- CSS Grid 布局优化

### 📝 详细信息

完整实现细节请查看 [上传队列实现文档](docs/archive/UPLOAD_QUEUE_IMPLEMENTATION.md)

---

## [v1.2.0] - 2025-11-17

### 🎯 主要变更

#### 移除账号密码登录功能
- 删除 `login.html` 和 `src/login.ts` 文件
- 移除界面中的"账号密码登录"按钮
- 移除后端的 `attempt_weibo_login` 命令
- **理由**: 账号密码登录容易触发微博风控和验证码，实际上并不可用

#### 移除自动续期功能
- 删除配置中的 `account` 字段
- 移除 Cookie 自动续期逻辑
- 简化配置文件结构
- **理由**: 没有实际意义，且会给用户造成困惑

#### 简化官方登录功能
- 保留"获取Cookie"按钮，打开指导窗口
- 窗口会在系统浏览器中打开 **m.weibo.cn**
- 提供详细的手动获取 Cookie 步骤说明
- 移除"自动获取Cookie"功能

#### 强调从 m.weibo.cn 获取 Cookie
- 在界面多处添加提示：必须从 m.weibo.cn（移动版）获取 Cookie
- 说明为什么必须使用移动版：因为应用使用的是移动版 API
- 桌面版（weibo.com）的 Cookie 无法使用

### 📝 详细信息

完整更新详情请查看 [v1.2.0 更新日志](docs/archive/CHANGELOG_v1.2.0.md)

---

## [v1.1.0] - 2025-11-17

### ✨ 新功能

#### 设置界面 v2.0
- **自动保存功能** - 配置修改后自动保存，无需手动点击
- **R2 连接测试** - 保存前可测试 R2 配置是否正确
- **WebDAV 连接测试** - 保存前可测试 WebDAV 配置是否正确
- **详细错误提示** - 测试失败时提供详细的错误信息和解决建议

#### WebDAV 自动备份
- 支持自动同步历史记录到 WebDAV 服务
- 支持坚果云、Nextcloud 等主流 WebDAV 服务
- 提供连接测试功能

#### R2 管理器改进
- 优化 UI 布局和样式
- 改进文件浏览体验
- 添加刷新和删除功能

### 📝 详细信息

- [设置 v2.0 用户指南](docs/guides/SETTINGS_V2_USER_GUIDE.md)
- [设置 v2.0 实现文档](docs/archive/SETTINGS_V2_IMPLEMENTATION.md)
- [WebDAV 设置指南](docs/guides/WEBDAV_SETUP_GUIDE.md)

---

## [v1.0.0] - 2025-11-16

### 🎉 初始版本发布

#### 核心功能
- ✅ 拖拽文件上传到微博
- ✅ 步骤 A: 上传微博（串行，阻塞性）
- ✅ 步骤 B: 备份 R2（并行，异步）
- ✅ 步骤 C: 生成链接（并行）
- ✅ 自动复制链接到剪贴板
- ✅ 系统通知（成功/失败）

#### 设置与配置
- ✅ 独立的设置窗口
- ✅ 微博 Cookie 配置和测试
- ✅ R2 配置（账户 ID、密钥、存储桶、路径）
- ✅ 输出格式选择（百度代理/微博原始/R2链接）
- ✅ 百度代理前缀配置

#### 界面与交互
- ✅ 极简主窗口（拖拽区域）
- ✅ 系统托盘（打开设置/历史/退出）
- ✅ 系统原生通知
- ✅ 历史记录窗口（最近 20 条）
- ✅ 历史记录一键复制功能

#### 非功能性需求
- ✅ 跨平台支持（Windows/macOS/Linux）
- ✅ 安全存储（使用 tauri-plugin-store 加密）
- ✅ 轻量化（使用 Tauri 而非 Electron）

#### 技术实现
- ✅ 微博 API 模拟（基于 weibo-picture-store 源码）
- ✅ R2 SDK 集成（@aws-sdk/client-s3）
- ✅ 可靠的错误处理（区分阻塞性/非阻塞性错误）

### 📝 详细信息

- [项目完成总结](docs/archive/PROJECT_SUMMARY.md)
- [安装指南](docs/archive/INSTALL.md)

---

## 版本规范

本项目遵循 [语义化版本 2.0.0](https://semver.org/lang/zh-CN/) 规范：

- **主版本号 (MAJOR)**: 不兼容的 API 修改
- **次版本号 (MINOR)**: 向下兼容的功能性新增
- **修订号 (PATCH)**: 向下兼容的问题修正

---

## 更新类型说明

- 🎉 **新功能** - 全新功能或重大特性
- 🚀 **性能优化** - 性能改进和优化
- 🔧 **技术改进** - 代码重构和技术债务处理
- 🐛 **问题修复** - Bug 修复
- 📝 **文档更新** - 文档改进
- ⚠️ **破坏性变更** - 不向下兼容的变更
- 🗑️ **废弃** - 即将移除的功能
- ❌ **移除** - 已移除的功能

---

## 未来计划

### v3.0 (计划中)
- [ ] 二维码登录支持
- [ ] 多账号管理
- [ ] 批量操作优化
- [ ] 主题切换（明暗模式）
- [ ] 国际化支持（英文、日文等）

### v2.7 (计划中)
- [ ] 上传进度显示优化（真实进度而非模拟）
- [ ] 队列项目删除/取消功能
- [ ] 队列暂停/恢复功能
- [ ] 历史记录搜索和过滤

---

## 贡献

如果您发现任何问题或有改进建议，欢迎：
- 提交 [Issue](https://github.com/your-username/WeiboDR-Uploader/issues)
- 提交 [Pull Request](https://github.com/your-username/WeiboDR-Uploader/pulls)
- 参与 [Discussions](https://github.com/your-username/WeiboDR-Uploader/discussions)

---

<div align="center">

**[返回主页](README.md)** | **[查看文档](docs/README.md)**

</div>

