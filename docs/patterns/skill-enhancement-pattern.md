# 技能增强模式：从单一职责到完整工作流

## 适用场景

当需要增强现有 Claude Code 技能，使其覆盖更完整的工作流程时使用此模式。

典型场景：
- 技能只处理部分流程，需要扩展覆盖范围
- 需要在技能中加入用户交互环节
- 需要支持多种输出类型或目标

## 模式说明

技能增强遵循"渐进式扩展"原则：

1. **保持原有功能** - 不破坏已有流程
2. **新增独立章节** - 用分隔线隔开，结构清晰
3. **提供判断逻辑** - 让 AI 知道何时触发新功能
4. **包含完整模板** - 减少 AI 的创造性发挥空间
5. **更新验证清单** - 确保新功能不被遗漏

## 代码示例

以 doc-sync 技能增强为例，新增知识沉淀功能：

### 1. 新增分类定义

```markdown
## 知识沉淀（代码变更后必须执行）

### 知识沉淀分类

| 分类 | 目录 | 适用场景 | 触发条件 |
|------|------|----------|----------|
| **问题修复** | `docs/fixes/` | Bug 排查 | 修复 Bug 后 |
| **踩坑记录** | `docs/gotchas/` | 常见陷阱 | 发现隐藏行为时 |
| ...
```

### 2. 提供判断逻辑

```markdown
### 知识沉淀优先级判断

| 优先级 | 条件 | 建议 |
|--------|------|------|
| **高** | 排查 > 30 分钟、涉及 3+ 文件 | 强烈建议记录 |
| **中** | 首次遇到的陷阱 | 建议记录 |
| **低** | 简单修复 | 询问用户意愿 |
```

### 3. 强制用户交互

```markdown
### 必须询问用户

完成代码变更后，主动询问：

📝 代码变更已完成。是否需要记录到知识库？
- fixes - 问题修复记录
- gotchas - 踩坑记录
- 跳过 - 无需记录
```

### 4. 提供完整模板

为每种类型提供标准化模板，确保输出一致性。

### 5. 更新验证清单

```markdown
- [ ] **已询问用户是否需要知识沉淀**
- [ ] 知识沉淀文档格式正确（如创建）
- [ ] 对应 README.md 索引已更新（如创建）
```

## 注意事项

1. **避免过度设计** - 只添加真正需要的功能
2. **保持向后兼容** - 原有流程不应被破坏
3. **模板要具体** - 减少 AI 的自由发挥空间
4. **验证清单是关键** - 确保新功能被执行

## 相关文件

- `.claude/skills/doc-sync/SKILL.md` - 本次增强的技能文件
- `CLAUDE.md` - 项目级 AI 指令，定义了知识沉淀规范
